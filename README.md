# WordPress & Laravel Local Development Environment

A complete Docker-based local development environment supporting both **WordPress** and **Laravel** projects with automatic project setup, intelligent project detection, and streamlined development workflows.

## 🛠️ Tools & Technologies

### Core Technologies

- **Docker** - Containerization platform for consistent development environments
- **Docker Compose** - Multi-container Docker applications
- **Traefik** - Reverse proxy and load balancer for automatic routing
- **MariaDB** - Database server (MySQL-compatible)
- **PHP** - Server-side scripting language
- **Nginx** - Web server (for Laravel projects)
- **Apache** - Web server (for WordPress projects)

### Development Tools

- **Composer** - PHP dependency management
- **GitHub Authentication** - For private repository access
- **MailHog** - Email testing and development
- **phpMyAdmin** - Database administration interface
- **WP-CLI** - Command-line interface for WordPress
- **Redis** - In-memory data structure store (for Laravel projects)

### Supported Frameworks

- **WordPress** - Latest stable version (6.5+) with WP-CLI integration
- **Laravel** - Modern PHP framework with full feature support

### System Requirements

- **Docker Desktop** - For Windows/macOS users
- **Docker Engine** - For Linux users
- **Bash Shell** - For script execution
- **Git** - Version control (optional but recommended)

## 🚀 Quick Start

### Automated Setup (Recommended)

The setup script automatically detects your project type and configures the environment:

```bash
cd wp-local/docker
./setup.sh <project-name>
```

**Examples:**
```bash
# For WordPress project
./setup.sh smartyapp

# For Laravel project  
./setup.sh smartylaravel
```

### Manual Setup

If you prefer manual control:

```bash
cd wp-local/docker

# For WordPress
docker-compose -f docker-compose.wordpress.yml up -d

# For Laravel
docker-compose -f docker-compose.laravel.yml up -d
```

## 🔧 Environment Configuration System

### Environment Files

The setup uses separate environment templates for different project types:

```text
docker/
├── .env                        # Auto-generated by setup.sh
├── .env.wordpress             # WordPress environment template
├── .env.laravel               # Laravel environment template
├── docker-compose.wordpress.yml
├── docker-compose.laravel.yml
├── Dockerfile.wordpress
├── Dockerfile.laravel
└── setup.sh                   # Automated setup script
```

### What are .env Files?

Environment files (`.env`) contain configuration variables that customize your Docker environment:

- **Project-specific settings** - APP_ID, PROJECT_DOMAIN, database credentials
- **Version control** - PHP version, MariaDB version, phpMyAdmin version
- **Authentication** - GitHub token for private repository access
- **Database configuration** - Database name, user, password

### How It Works

1. **Template Selection**: Setup script detects project type (WordPress/Laravel)
2. **Environment Generation**: Copies appropriate template (`.env.wordpress` or `.env.laravel`)
3. **Variable Substitution**: Replaces placeholders with your project name
4. **Container Launch**: Uses the generated `.env` file for Docker configuration

### Environment Variables Explained

| Variable | Purpose | Example |
|----------|---------|---------|
| `APP_ID` | Project identifier | `smartyapp` |
| `PROJECT_DOMAIN` | Local domain | `smartyapp.test` |
| `DB_NAME` | Database name | `smartyapp` |
| `DB_USER` | Database user | `smartyapp` |
| `DB_PASSWORD` | Database password | `smartyapp` |
| `PHP_VERSION` | PHP Docker image version | `8.3-apache` |
| `MARIADB_VERSION` | MariaDB version | `10.11` |
| `GITHUB_AUTH_TOKEN` | GitHub authentication | `ghp_xyz123...` |

## 📁 Project Structure

```text
wp-local/
├── docker/
│   ├── .env                          # Auto-generated environment
│   ├── .env.wordpress               # WordPress template
│   ├── .env.laravel                 # Laravel template
│   ├── docker-compose.wordpress.yml # WordPress services
│   ├── docker-compose.laravel.yml   # Laravel services
│   ├── Dockerfile.wordpress         # WordPress container
│   ├── Dockerfile.laravel           # Laravel container
│   ├── setup.sh                     # Automated setup script
│   ├── nginx.conf                   # Nginx configuration
│   ├── default.conf                 # Default site configuration
│   └── supervisord.conf             # Process management
├── www/
│   ├── smartyapp/                   # WordPress project
│   │   ├── wp/                      # WordPress core files
│   │   ├── mysql/                   # Database files
│   │   └── composer.json            # WordPress dependencies
│   └── smartylaravel/               # Laravel project
│       ├── app/                     # Laravel application
│       ├── public/                  # Public web directory
│       ├── mysql/                   # Database files
│       ├── redis/                   # Redis data
│       └── composer.json            # Laravel dependencies
└── README.md                        # This documentation
```

## 🎯 Project Detection

The setup script automatically detects your project type:

### WordPress Detection
- Looks for `wp-config.php` or `wp/wp-config.php`
- Uses `docker-compose.wordpress.yml`
- Mounts `../www/{project}/wp:/var/www/html`

### Laravel Detection  
- Looks for `artisan` file and `composer.json`
- Uses `docker-compose.laravel.yml`
- Mounts `../www/{project}:/var/www/html`

## 🐳 Available Services

| Service | WordPress URL | Laravel URL | Description |
|---------|---------------|-------------|-------------|
| Your Site | `http://smartyapp.test` | `http://smartylaravel.test` | Your application |
| phpMyAdmin | `http://phpmyadmin.test` | `http://phpmyadmin.test` | Database management |
| MailHog | `http://mailhog.test` | `http://mailhog.test` | Email testing |
| Traefik Dashboard | `http://localhost:8080` | `http://localhost:8080` | Proxy management |

## 🔧 Setup Script Usage

### Basic Usage

```bash
# From wp-local/docker/ directory
./setup.sh <project-name>
```

### What the Script Does

1. **Project Detection**: Automatically detects WordPress or Laravel
2. **Environment Setup**: Copies and configures appropriate `.env` file
3. **Variable Substitution**: Updates project-specific variables
4. **Container Management**: Stops existing containers and starts new ones
5. **Dependency Installation**: Installs Composer dependencies (Laravel)
6. **Laravel Setup**: Runs key generation and migrations (Laravel projects)

### Script Output

```bash
# From wp-local/docker/ directory
./setup.sh smartylaravel
ℹ️  Setting up Docker environment for project: smartylaravel
✅ Detected Laravel project
✅ Using Laravel environment configuration
✅ Environment configured for smartylaravel (laravel)
🚀 Project started successfully!
ℹ️  Project URL: http://smartylaravel.test
ℹ️  phpMyAdmin: http://phpmyadmin.test
ℹ️  Installing Laravel dependencies...
```

## 🔄 Manual Docker Commands

### Clearing All Containers (Important!)

Before switching between WordPress and Laravel, always clear all containers to avoid conflicts:

```bash
# From any directory
# Stop all running containers
docker stop $(docker ps -q)

# Remove all containers
docker rm $(docker ps -a -q)

# Remove all networks (optional)
docker network prune -f

# Remove all volumes (optional - this will delete databases!)
docker volume prune -f

# Complete cleanup (removes images, containers, networks, volumes)
docker system prune -a -f --volumes
```

### WordPress Projects

```bash
# From wp-local/docker/ directory
# Start WordPress environment
docker-compose -f docker-compose.wordpress.yml up -d

# Stop WordPress environment
docker-compose -f docker-compose.wordpress.yml down

# Stop WordPress with volume removal
docker-compose -f docker-compose.wordpress.yml down -v

# Rebuild WordPress containers
docker-compose -f docker-compose.wordpress.yml up --build -d

# View WordPress logs
docker-compose -f docker-compose.wordpress.yml logs -f
```

### Laravel Projects

```bash
# From wp-local/docker/ directory
# Start Laravel environment
docker-compose -f docker-compose.laravel.yml up -d

# Stop Laravel environment
docker-compose -f docker-compose.laravel.yml down

# Stop Laravel with volume removal
docker-compose -f docker-compose.laravel.yml down -v

# Rebuild Laravel containers
docker-compose -f docker-compose.laravel.yml up --build -d

# View Laravel logs
docker-compose -f docker-compose.laravel.yml logs -f
```

### Switching Between Projects

When switching from WordPress to Laravel (or vice versa):

```bash
# Method 1: Stop specific project first
# From wp-local/docker/ directory
docker-compose -f docker-compose.wordpress.yml down
docker-compose -f docker-compose.laravel.yml up -d

# Method 2: Use the setup script (recommended)
# From wp-local/docker/ directory
./setup.sh smartylaravel  # Automatically stops WordPress and starts Laravel

# Method 3: Complete cleanup (if having issues)
# From any directory
docker stop $(docker ps -q)
docker rm $(docker ps -a -q)
# From wp-local/docker/ directory
./setup.sh smartylaravel
```

### Laravel-Specific Commands

```bash
# From any directory
# Access Laravel container
docker exec -it laravel_smartylaravel bash

# Run Laravel commands
docker exec -it laravel_smartylaravel php artisan migrate
docker exec -it laravel_smartylaravel php artisan tinker
docker exec -it laravel_smartylaravel composer install
```

### WordPress-Specific Commands

```bash
# From any directory
# Access WordPress container
docker exec -it php_smartyapp bash

# Run WP-CLI commands
docker exec -it php_smartyapp wp --allow-root user list
docker exec -it php_smartyapp wp --allow-root plugin list
```

## 🔧 Environment Customization

### Creating Custom Environment Files

You can create project-specific environment files:

```bash
# From wp-local/docker/ directory
# Copy template
cp .env.laravel .env.myproject

# Edit variables
nano .env.myproject

# Use custom environment
cp .env.myproject .env
docker-compose -f docker-compose.laravel.yml up -d
```

### Adding New Variables

Add variables to your environment template:

```bash
# From wp-local/docker/ directory
# Edit .env.laravel file
nano .env.laravel

# Add these variables:
APP_DEBUG=true
APP_ENV=local
MAIL_DRIVER=smtp
```

## 🛠️ Container Architecture

### WordPress Container (docker-php)
- **Base**: `php:8.3-apache`
- **Services**: Apache, PHP, WP-CLI
- **Volumes**: WordPress files, database, uploads
- **Networking**: Traefik routing

### Laravel Container (docker-laravel)
- **Base**: `php:8.3-fpm`
- **Services**: Nginx, PHP-FPM, Supervisor
- **Volumes**: Laravel application, database, storage
- **Networking**: Traefik routing, Redis connection

### Shared Services
- **MariaDB**: Database server
- **Redis**: Caching and sessions (Laravel)
- **Traefik**: Reverse proxy and SSL termination
- **phpMyAdmin**: Database management interface
- **MailHog**: Email testing and debugging

## 🔍 Troubleshooting

### Common Issues

1. **Containers from previous project still running:**
   ```bash
   # From any directory
   # Check what containers are running
   docker ps
   
   # Stop all containers
   docker stop $(docker ps -q)
   
   # Remove all containers
   docker rm $(docker ps -a -q)
   
   # From wp-local/docker/ directory
   # Then start your new project
   ./setup.sh project-name
   ```

2. **Port conflicts:**
   ```bash
   # From any directory
   # Check what's using port 80
   sudo lsof -i :80
   
   # Stop conflicting services
   sudo service apache2 stop
   sudo service nginx stop
   ```

3. **Permission issues:**
   ```bash
   # From wp-local/ directory
   # Fix file permissions
   sudo chown -R $USER:$USER www/
   
   # From any directory
   # Laravel storage permissions
   docker exec -it laravel_project chmod -R 755 storage/
   ```

4. **Database connection errors:**
   ```bash
   # From wp-local/docker/ directory
   # Reset environment
   docker-compose down -v
   ./setup.sh project-name
   ```

5. **Container build failures:**
   ```bash
   # From any directory
   # Clean Docker cache
   docker system prune -a
   
   # From wp-local/docker/ directory
   # Rebuild without cache
   docker-compose up --build --no-cache
   ```

6. **WordPress containers still active when trying to start Laravel:**
   ```bash
   # From wp-local/docker/ directory
   # Quick fix
   docker-compose -f docker-compose.wordpress.yml down
   docker-compose -f docker-compose.laravel.yml up -d
   
   # Or use setup script (recommended)
   ./setup.sh smartylaravel
   ```

7. **Database user doesn't exist error (Laravel):**
   ```bash
   # From any directory
   # If you get "Access denied for user 'projectname'" error
   docker exec db_projectname mysql -u root -proot -e "CREATE USER 'projectname'@'%' IDENTIFIED BY 'projectname';"
   docker exec db_projectname mysql -u root -proot -e "CREATE DATABASE IF NOT EXISTS projectname;"
   docker exec db_projectname mysql -u root -proot -e "GRANT ALL PRIVILEGES ON projectname.* TO 'projectname'@'%';"
   docker exec db_projectname mysql -u root -proot -e "FLUSH PRIVILEGES;"
   
   # Then run migrations
   docker exec laravel_projectname php artisan migrate --no-interaction
   ```

### Debug Commands

```bash
# From any directory
# Check container status
docker ps

# View container logs
docker logs container_name

# Check environment variables
docker exec -it container_name env

# Test database connection
docker exec -it db_project mysql -u root -p

# Check file permissions
docker exec -it container_name ls -la /var/www/html
```

## 📊 Performance Optimization

### Laravel Performance

```bash
# From any directory
# Optimize Laravel
docker exec -it laravel_project php artisan optimize
docker exec -it laravel_project php artisan config:cache
docker exec -it laravel_project php artisan route:cache
docker exec -it laravel_project php artisan view:cache
```

### WordPress Performance

```bash
# From any directory
# Enable object caching
docker exec -it php_project wp --allow-root plugin install redis-cache --activate

# Optimize database
docker exec -it php_project wp --allow-root db optimize
```

## 🔐 Security Best Practices

### Production Considerations

- **Environment Files**: Never commit `.env` files to version control
- **Database Credentials**: Use strong passwords in production
- **GitHub Tokens**: Use minimal required permissions
- **Container Security**: Regularly update base images

### Development Security

- **Local Only**: This setup is for local development only
- **Firewall**: Ensure Docker ports aren't exposed externally
- **Backup**: Regularly backup your project files and databases

## 🎯 Advanced Usage

### Multi-Project Setup

```bash
# From wp-local/docker/ directory
# Project 1 (WordPress)
./setup.sh myblog
# Visit: http://myblog.test

# Project 2 (Laravel)
./setup.sh myapi
# Visit: http://myapi.test

# Both projects run simultaneously
# Each has isolated database and environment
```

### Custom Domain Configuration

Add custom domains to `/etc/hosts`:

```bash
# From any directory
# Edit hosts file
sudo nano /etc/hosts

# Add entries
127.0.0.1 custom-domain.test
127.0.0.1 another-project.test
```

### SSL Configuration

Traefik can be configured for SSL:

```yaml
# In docker-compose files
labels:
  - "traefik.http.routers.project.tls=true"
  - "traefik.http.routers.project.rule=Host(`project.test`)"
```

## 📝 Tips and Best Practices

### Development Workflow

1. **Use the setup script** for consistent environments
2. **Backup databases** before major changes
3. **Use version control** for your application code
4. **Test migrations** before applying to production
5. **Monitor container logs** for debugging

### Code Organization

```bash
# WordPress
www/project/wp/                    # WordPress core (don't edit)
www/project/wp/wp-content/themes/  # Custom themes
www/project/wp/wp-content/plugins/ # Custom plugins

# Laravel
www/project/app/                   # Application logic
www/project/resources/             # Views and assets
www/project/database/migrations/   # Database migrations
```

## 🔄 Updates and Maintenance

### Updating WordPress

```bash
# From any directory
# Update WordPress core
docker exec -it php_project wp --allow-root core update

# Update plugins
docker exec -it php_project wp --allow-root plugin update --all

# Update themes
docker exec -it php_project wp --allow-root theme update --all
```

### Updating Laravel

```bash
# From any directory
# Update dependencies
docker exec -it laravel_project composer update

# Run migrations
docker exec -it laravel_project php artisan migrate

# Clear caches
docker exec -it laravel_project php artisan cache:clear
```

### Updating Docker Images

```bash
# From wp-local/docker/ directory
# Pull latest images
docker-compose pull

# Rebuild containers
docker-compose up --build -d
```

---

## 📋 Versioning & Releases

This project follows [Semantic Versioning](https://semver.org/) and uses automated releases via [semantic-release](https://github.com/semantic-release/semantic-release).

### Version Format
- **Major** (X.0.0): Breaking changes
- **Minor** (0.X.0): New features, backwards compatible
- **Patch** (0.0.X): Bug fixes, backwards compatible

### Automated Releases
Releases are automatically created when changes are pushed to the `main` branch. The version number is determined by analyzing commit messages following the [Conventional Commits](https://www.conventionalcommits.org/) specification.

### Commit Message Format
```bash
# Features (minor version bump)
feat(docker): add Redis service for caching

# Bug fixes (patch version bump)
fix: resolve MySQL connection timeout

# Breaking changes (major version bump)
feat(docker)!: upgrade to PHP 8.3
```

For more details, see [CONTRIBUTING.md](CONTRIBUTING.md).

---

## 🤝 Contributing

We welcome contributions! Please follow our commit message conventions to ensure proper versioning:

1. Use conventional commits format: `type(scope): description`
2. Run `npm run commit` for an interactive commit experience
3. Create feature branches and submit pull requests
4. Automated tests and releases run on merge to main

See [CONTRIBUTING.md](CONTRIBUTING.md) for detailed guidelines.

---

**Happy Development! 🚀**

*This environment supports both WordPress and Laravel development with automatic project detection, intelligent environment configuration, and streamlined workflows for modern PHP development.*