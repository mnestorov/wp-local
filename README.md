# WordPress & Laravel Local Development Environment

[![Last Update](https://img.shields.io/github/last-commit/mnestorov/wp-local/main.svg?label=last%20update)](https://github.com/mnestorov/wp-local/commits/main)
[![Version](https://img.shields.io/github/v/release/mnestorov/wp-local?label=version)](https://github.com/mnestorov/wp-local/releases)
[![Platform](https://img.shields.io/badge/platform-macOS%20%7C%20Linux-blue)](https://www.docker.com/)

A complete Docker-based local development environment supporting both **WordPress** and **Laravel** projects with automatic project setup, intelligent project detection, and streamlined development workflows.

## 📰 Latest Updates

### Version Updates (October 2025)

- **Traefik**: Upgraded to v3.5 (latest stable release)
- **phpMyAdmin**: Updated to latest version for improved security
- **Adminer**: Updated to latest version for better performance
- **PHP**: Already using 8.4 (latest stable) in all Docker images
- **Composer**: Using version 2.8 for better dependency management
- **MariaDB**: Continues with 11.6 LTS for stability
- **Redis**: Using 7.4 Alpine for minimal footprint
- **Elasticsearch/Kibana**: 7.17.25 with full security features enabled

## 🛠️ Tools & Technologies

### Core Technologies

- **Docker** - Containerization platform for consistent development environments
- **Docker Compose** - Multi-container Docker applications
- **Traefik v3.5** - Modern reverse proxy and load balancer for automatic routing (latest stable)
- **MariaDB 11.6** - Latest LTS database server (MySQL-compatible)
- **PHP 8.4** - Latest PHP version with improved performance and features
- **Nginx** - Web server (for Laravel projects)
- **Apache** - Web server (for WordPress projects)

### Development Tools

- **Composer 2.8** - PHP dependency management
- **GitHub Authentication** - For private repository access
- **Mailpit** - Modern email testing and development tool
- **phpMyAdmin** - Database administration interface (latest version)
- **Adminer** - Lightweight database administration tool (latest version)
- **Elasticsearch 7.17.25** - Search and analytics engine with security enabled
- **Kibana 7.17.25** - Elasticsearch data visualization with authentication
- **WP-CLI** - Command-line interface for WordPress
- **Redis 7.4** - In-memory data structure store (for Laravel projects)

### Supported Frameworks

- **WordPress** - Latest stable version (6.5+) with WP-CLI integration
- **Laravel** - Modern PHP framework with full feature support

### System Requirements

- **Docker Desktop** - For Windows/macOS users
- **Docker Engine** - For Linux users
- **Bash Shell** - For script execution
- **Git** - Version control (optional but recommended)

## 🚀 Quick Start

### Automated Setup (Recommended)

The setup script automatically detects your project type and configures the environment:

```bash
cd wp-local/docker
./setup.sh <project-name>
```

**Examples:**

```bash
# For WordPress project
./setup.sh smartyapp

# For Laravel project  
./setup.sh smartylaravel
```

### Manual Setup

If you prefer manual control:

```bash
cd wp-local/docker

# For WordPress
docker-compose -f docker-compose.wordpress.yml up -d

# For Laravel
docker-compose -f docker-compose.laravel.yml up -d
```

## 🔧 Environment Configuration System

### Environment Files

The setup uses separate environment templates for different project types:

```text
docker/
├── .env                        # Auto-generated by setup.sh
├── .env.wordpress             # WordPress environment template
├── .env.laravel               # Laravel environment template
├── docker-compose.wordpress.yml
├── docker-compose.laravel.yml
├── Dockerfile.wordpress
├── Dockerfile.laravel
└── setup.sh                   # Automated setup script
```

### What are .env Files?

Environment files (`.env`) contain configuration variables that customize your Docker environment:

- **Project-specific settings** - APP_ID, PROJECT_DOMAIN, database credentials
- **Version control** - PHP version, MariaDB version, phpMyAdmin version
- **Authentication** - GitHub token for private repository access
- **Database configuration** - Database name, user, password

### How It Works

1. **Template Selection**: Setup script detects project type (WordPress/Laravel)
2. **Environment Generation**: Copies appropriate template (`.env.wordpress` or `.env.laravel`)
3. **Variable Substitution**: Replaces placeholders with your project name
4. **Container Launch**: Uses the generated `.env` file for Docker configuration

### Environment Variables Explained

| Variable | Purpose | Example |
|----------|---------|---------|
| `APP_ID` | Project identifier | `smartyapp` |
| `PROJECT_DOMAIN` | Local domain | `smartyapp.test` |
| `DB_NAME` | Database name | `smartyapp` |
| `DB_USER` | Database user | `smartyapp` |
| `DB_PASSWORD` | Database password | `smartyapp` |
| `PHP_VERSION` | PHP Docker image version | `8.4-apache` |
| `MARIADB_VERSION` | MariaDB version | `11.6` |
| `GITHUB_AUTH_TOKEN` | GitHub authentication | `ghp_xyz123...` |

## 📁 Project Structure

```text
wp-local/
├── docker/
│   ├── .env                          # Auto-generated environment
│   ├── .env.wordpress               # WordPress template
│   ├── .env.laravel                 # Laravel template
│   ├── docker-compose.wordpress.yml # WordPress services
│   ├── docker-compose.laravel.yml   # Laravel services
│   ├── Dockerfile.wordpress         # WordPress container
│   ├── Dockerfile.laravel           # Laravel container
│   ├── setup.sh                     # Automated setup script
│   ├── nginx.conf                   # Nginx configuration
│   ├── default.conf                 # Default site configuration
│   └── supervisord.conf             # Process management
├── www/
│   ├── smartyapp/                   # WordPress project
│   │   ├── wp/                      # WordPress core files
│   │   ├── mysql/                   # Database files
│   │   ├── elasticsearch/           # Search index data
│   │   └── composer.json            # WordPress dependencies
│   └── smartylaravel/               # Laravel project
│       ├── app/                     # Laravel application
│       ├── public/                  # Public web directory
│       ├── mysql/                   # Database files
│       ├── redis/                   # Redis data
│       ├── elasticsearch/           # Search index data
│       └── composer.json            # Laravel dependencies
└── README.md                        # This documentation
```

## 🎯 Project Detection

The setup script automatically detects your project type:

### WordPress Detection

- Looks for `wp-config.php` or `wp/wp-config.php`
- Uses `docker-compose.wordpress.yml`
- Mounts `../www/{project}/wp:/var/www/html`

### Laravel Detection

- Looks for `artisan` file and `composer.json`
- Uses `docker-compose.laravel.yml`
- Mounts `../www/{project}:/var/www/html`

## 🐳 Available Services

| Service | WordPress URL | Laravel URL | Description |
|---------|---------------|-------------|-------------|
| Your Site | `http://smartyapp.test` | `http://smartylaravel.test` | Your application |
| phpMyAdmin | `http://phpmyadmin.test` | `http://phpmyadmin.test` | Database management (full-featured) |
| Adminer | `http://adminer.test` | `http://adminer.test` | Database management (lightweight) |
| Mailpit | `http://mailpit.test` | `http://mailpit.test` | Email testing and debugging |
| Kibana | `http://kibana-smartyapp.test` | `http://kibana-smartylaravel.test` | Elasticsearch visualization |
| Elasticsearch | `http://localhost:9201` | `http://localhost:9200` | Search and analytics API |
| Traefik Dashboard | `http://localhost:8080` | `http://localhost:8080` | Proxy management |

## 🔧 Setup Script Usage

### Basic Usage

```bash
# From wp-local/docker/ directory
./setup.sh <project-name>
```

### What the Script Does

1. **Project Detection**: Automatically detects WordPress or Laravel
2. **Environment Setup**: Copies and configures appropriate `.env` file
3. **Variable Substitution**: Updates project-specific variables
4. **Container Management**: Stops existing containers and starts new ones
5. **Dependency Installation**: Installs Composer dependencies (Laravel)
6. **Laravel Setup**: Runs key generation and migrations (Laravel projects)

### Script Output

```bash
# From wp-local/docker/ directory
./setup.sh smartylaravel
ℹ️  Setting up Docker environment for project: smartylaravel
✅ Detected Laravel project
✅ Using Laravel environment configuration
✅ Environment configured for smartylaravel (laravel)
🚀 Project started successfully!
ℹ️  Project URL: http://smartylaravel.test
ℹ️  phpMyAdmin: http://phpmyadmin.test
ℹ️  Installing Laravel dependencies...
```

## 🔄 Manual Docker Commands

### Clearing All Containers (Important!)

Before switching between WordPress and Laravel, always clear all containers to avoid conflicts:

```bash
# From any directory
# Stop all running containers
docker stop $(docker ps -q)

# Remove all containers
docker rm $(docker ps -a -q)

# Remove all networks (optional)
docker network prune -f

# Remove all volumes (optional - this will delete databases!)
docker volume prune -f

# Complete cleanup (removes images, containers, networks, volumes)
docker system prune -a -f --volumes
```

### WordPress Projects

```bash
# From wp-local/docker/ directory
# Start WordPress environment
docker-compose -f docker-compose.wordpress.yml up -d

# Stop WordPress environment
docker-compose -f docker-compose.wordpress.yml down

# Stop WordPress with volume removal
docker-compose -f docker-compose.wordpress.yml down -v

# Rebuild WordPress containers
docker-compose -f docker-compose.wordpress.yml up --build -d

# View WordPress logs
docker-compose -f docker-compose.wordpress.yml logs -f
```

### Laravel Projects

```bash
# From wp-local/docker/ directory
# Start Laravel environment
docker-compose -f docker-compose.laravel.yml up -d

# Stop Laravel environment
docker-compose -f docker-compose.laravel.yml down

# Stop Laravel with volume removal
docker-compose -f docker-compose.laravel.yml down -v

# Rebuild Laravel containers
docker-compose -f docker-compose.laravel.yml up --build -d

# View Laravel logs
docker-compose -f docker-compose.laravel.yml logs -f
```

### Switching Between Projects

When switching from WordPress to Laravel (or vice versa):

```bash
# Method 1: Stop specific project first
# From wp-local/docker/ directory
docker-compose -f docker-compose.wordpress.yml down
docker-compose -f docker-compose.laravel.yml up -d

# Method 2: Use the setup script (recommended)
# From wp-local/docker/ directory
./setup.sh smartylaravel  # Automatically stops WordPress and starts Laravel

# Method 3: Complete cleanup (if having issues)
# From any directory
docker stop $(docker ps -q)
docker rm $(docker ps -a -q)
# From wp-local/docker/ directory
./setup.sh smartylaravel
```

### Laravel-Specific Commands

```bash
# From any directory
# Access Laravel container
docker exec -it laravel_smartylaravel bash

# Run Laravel commands
docker exec -it laravel_smartylaravel php artisan migrate
docker exec -it laravel_smartylaravel php artisan tinker
docker exec -it laravel_smartylaravel composer install
```

### WordPress-Specific Commands

```bash
# From any directory
# Access WordPress container
docker exec -it php_smartyapp bash

# Run WP-CLI commands
docker exec -it php_smartyapp wp --allow-root user list
docker exec -it php_smartyapp wp --allow-root plugin list
```

## 🔧 Environment Customization

### Creating Custom Environment Files

You can create project-specific environment files:

```bash
# From wp-local/docker/ directory
# Copy template
cp .env.laravel .env.myproject

# Edit variables
nano .env.myproject

# Use custom environment
cp .env.myproject .env
docker-compose -f docker-compose.laravel.yml up -d
```

### Adding New Variables

Add variables to your environment template:

```bash
# From wp-local/docker/ directory
# Edit .env.laravel file
nano .env.laravel

# Add these variables:
APP_DEBUG=true
APP_ENV=local
MAIL_DRIVER=smtp
```

## 🛠️ Container Architecture

### WordPress Container (docker-php)

- **Base**: `php:8.4-apache`
- **Services**: Apache, PHP, WP-CLI
- **Volumes**: WordPress files, database, uploads, elasticsearch data
- **Networking**: Traefik routing

### Laravel Container (docker-laravel)

- **Base**: `php:8.4-fpm`
- **Services**: Nginx, PHP-FPM, Supervisor
- **Volumes**: Laravel application, database, storage, elasticsearch data
- **Networking**: Traefik routing, Redis connection

### Shared Services

- **MariaDB 11.6**: Database server
- **Redis 7.4**: Caching and sessions (Laravel)
- **Traefik v3.5**: Reverse proxy and SSL termination (latest stable)
- **phpMyAdmin latest**: Full-featured database management interface
- **Adminer latest**: Lightweight database administration tool
- **Mailpit latest**: Modern email testing and debugging
- **Elasticsearch 7.17.25**: Search and analytics engine with security enabled
- **Kibana 7.17.25**: Data visualization and monitoring with authentication

## 🔍 Troubleshooting

### Common Issues

1. **Containers from previous project still running:**

   ```bash
   # From any directory
   # Check what containers are running
   docker ps
   
   # Stop all containers
   docker stop $(docker ps -q)
   
   # Remove all containers
   docker rm $(docker ps -a -q)
   
   # From wp-local/docker/ directory
   # Then start your new project
   ./setup.sh project-name
   ```

2. **Port conflicts:**

   ```bash
   # From any directory
   # Check what's using port 80
   sudo lsof -i :80
   
   # Stop conflicting services
   sudo service apache2 stop
   sudo service nginx stop
   ```

3. **Permission issues:**

   ```bash
   # From wp-local/ directory
   # Fix file permissions
   sudo chown -R $USER:$USER www/
   
   # From any directory
   # Laravel storage permissions
   docker exec -it laravel_{project-name} chmod -R 755 storage/
   ```

4. **Database connection errors:**

   ```bash
   # From wp-local/docker/ directory
   # Reset environment
   docker-compose down -v
   ./setup.sh project-name
   ```

5. **Container build failures:**

   ```bash
   # From any directory
   # Clean Docker cache
   docker system prune -a
   
   # From wp-local/docker/ directory
   # Rebuild without cache
   docker-compose up --build --no-cache
   ```

6. **WordPress containers still active when trying to start Laravel:**

   ```bash
   # From wp-local/docker/ directory
   # Quick fix
   docker-compose -f docker-compose.wordpress.yml down
   docker-compose -f docker-compose.laravel.yml up -d
   
   # Or use setup script (recommended)
   ./setup.sh smartylaravel
   ```

7. **Database user doesn't exist error (Laravel):**

   ```bash
   # From any directory
   # If you get "Access denied for user 'projectname'" error
   docker exec db_{project-name} mysql -u root -proot -e "CREATE USER 'projectname'@'%' IDENTIFIED BY 'projectname';"
   docker exec db_{project-name} mysql -u root -proot -e "CREATE DATABASE IF NOT EXISTS projectname;"
   docker exec db_{project-name} mysql -u root -proot -e "GRANT ALL PRIVILEGES ON projectname.* TO 'projectname'@'%';"
   docker exec db_{project-name} mysql -u root -proot -e "FLUSH PRIVILEGES;"
   
   # Then run migrations
   docker exec laravel_{project-name} php artisan migrate --no-interaction
   ```

### Debug Commands

```bash
# From any directory
# Check container status
docker ps

# View container logs
docker logs container_name

# Check environment variables
docker exec -it container_name env

# Test database connection
docker exec -it db_{project-name} mysql -u root -p

# Check file permissions
docker exec -it container_name ls -la /var/www/html
```

## 🔍 Database Administration Tools

### phpMyAdmin vs Adminer

Both tools are available for database management:

**phpMyAdmin** (`http://phpmyadmin.test`):

- Full-featured database administration
- WordPress-friendly interface
- Comprehensive import/export tools
- Plugin ecosystem

**Adminer** (`http://adminer.test`):

- Lightweight and fast
- Clean, modern interface
- Supports multiple database types
- Better performance for large datasets

### Using Adminer

```bash
# Access Adminer at http://adminer.test
# Login credentials:
# Server: db
# Username: root
# Password: root
# Database: [your-project-name]
```

## 🔍 Search & Analytics with Elasticsearch

### Elasticsearch Integration

#### Initial Elasticsearch Setup

```bash
# Check Elasticsearch cluster health (with authentication)
curl -u elastic:changeme http://localhost:9200/_cluster/health?pretty

# Check cluster status (quick view)
curl -u elastic:changeme http://localhost:9200/_cat/health

# View all indices
curl -u elastic:changeme http://localhost:9200/_cat/indices
```

**Security Enabled**: Elasticsearch 7.17.25 with authentication enabled for Fleet and Agent integrations.
**Default Credentials**: Username: `elastic`, Password: `changeme`

#### Laravel

```bash
# Install Laravel Scout for Elasticsearch
docker exec -it laravel_{project-name} composer require laravel/scout
docker exec -it laravel_{project-name} composer require matchish/laravel-scout-elasticsearch

# Configure in your Laravel .env
SCOUT_DRIVER=elasticsearch
ELASTICSEARCH_HOST=elasticsearch:9200
ELASTICSEARCH_USERNAME=elastic
ELASTICSEARCH_PASSWORD=changeme

# Create and sync searchable models
docker exec -it laravel_{project-name} php artisan scout:import "App\Models\Post"
```

#### WordPress

```bash
# Install ElasticPress plugin
docker exec -it php_{project-name} wp --allow-root plugin install elasticpress --activate

# Configure Elasticsearch endpoint in WordPress admin:
# Settings > ElasticPress > Settings
# Host: http://elasticsearch:9200
# Username: elastic
# Password: changeme

# Index content via WP-CLI
docker exec -it php_{project-name} wp --allow-root elasticpress index --setup
```

### Kibana Dashboards

Access Kibana at `http://kibana-{project-name}.test` to:

- Monitor search performance
- Create data visualizations
- Analyze user search patterns
- Track application metrics

#### Kibana Setup & Access

```bash
# Access Kibana with authentication
# URL: http://kibana-{project-name}.test
# Username: elastic
# Password: changeme

# View Kibana logs for debugging
docker logs kibana_{project-name}

# Check Elasticsearch connection from Kibana container
docker exec -it kibana_{project-name} curl -u elastic:changeme http://elasticsearch:9200/_cluster/health
```

#### Security Features Enabled

- **Authentication Required**: Login with username `elastic` and password `changeme`
- **Fleet Management**: Now available for Elastic Agent integrations
- **API Keys**: Enabled for agent authentication (`xpack.security.authc.api_key.enabled=true`)
- **Full Security**: All Elasticsearch security features are active

### Elasticsearch Management

```bash
# Check Elasticsearch status
curl http://localhost:9200/_cluster/health

# View all indices
curl http://localhost:9200/_cat/indices

# Search data directly
curl -X GET "localhost:9200/your_index/_search?pretty"
```

## 📊 Performance Optimization

### Laravel Performance

```bash
# From any directory
# Optimize Laravel
docker exec -it laravel_{project-name} php artisan optimize
docker exec -it laravel_{project-name} php artisan config:cache
docker exec -it laravel_{project-name} php artisan route:cache
docker exec -it laravel_{project-name} php artisan view:cache
```

### WordPress Performance

```bash
# From any directory
# Enable object caching
docker exec -it php_{project-name} wp --allow-root plugin install redis-cache --activate

# Install Elasticsearch plugin for enhanced search
docker exec -it php_{project-name} wp --allow-root plugin install elasticpress --activate

# Optimize database
docker exec -it php_{project-name} wp --allow-root db optimize
```

## 📧 Email Testing with Mailpit

### Using Mailpit

Mailpit replaces MailHog and provides modern email testing:

**Access**: `http://mailpit.test`

**Features**:

- Modern web interface
- Real-time email capture
- HTML email rendering
- Attachment handling
- Email search and filtering

**Laravel Configuration**:

```bash
# Already configured in docker-compose
MAIL_MAILER=smtp
MAIL_HOST=mailpit
MAIL_PORT=1025
MAIL_USERNAME=null
MAIL_PASSWORD=null
MAIL_ENCRYPTION=null
```

**WordPress Configuration**:

- Install SMTP plugin or configure in wp-config.php
- SMTP Server: mailpit
- Port: 1025
- No authentication required

**Testing Emails**:

```bash
# Laravel - send test email
docker exec -it laravel_{project-name} php artisan tinker
# In tinker: Mail::raw('Test email', function($msg) { $msg->to('test@example.com')->subject('Test'); });

# WordPress - use WP-CLI
docker exec -it php_{project-name} wp --allow-root eval "wp_mail('test@example.com', 'Test Subject', 'Test message');"
```

## 🔐 Security Best Practices

### Production Considerations

- **Environment Files**: Never commit `.env` files to version control
- **Database Credentials**: Use strong passwords in production
- **GitHub Tokens**: Use minimal required permissions
- **Container Security**: Regularly update base images

### Development Security

- **Local Only**: This setup is for local development only
- **Firewall**: Ensure Docker ports aren't exposed externally
- **Backup**: Regularly backup your project files and databases

## 🎯 Advanced Usage

### Multi-Project Setup

**Directory:** `wp-local/docker/`

```bash
# Project 1 (WordPress)
./setup.sh myblog
# Visit: http://myblog.test

# Project 2 (Laravel)
./setup.sh myapi
# Visit: http://myapi.test

# Both projects run simultaneously
# Each has isolated database and environment
```

### Custom Domain Configuration

**Directory:** `any`

Add custom domains to `/etc/hosts`:

```bash
# Edit hosts file
sudo nano /etc/hosts

# Add entries
127.0.0.1 custom-domain.test
127.0.0.1 another-project.test
```

### SSL Configuration

Traefik can be configured for SSL:

```yaml
# In docker-compose files
labels:
  - "traefik.http.routers.project.tls=true"
  - "traefik.http.routers.project.rule=Host(`project.test`)"
```

## 📝 Tips and Best Practices

### Development Workflow

1. **Use the setup script** for consistent environments
2. **Backup databases** before major changes
3. **Use version control** for your application code
4. **Test migrations** before applying to production
5. **Monitor container logs** for debugging

### Code Organization

```bash
# WordPress
www/project/wp/                    # WordPress core (don't edit)
www/project/wp/wp-content/themes/  # Custom themes
www/project/wp/wp-content/plugins/ # Custom plugins

# Laravel
www/project/app/                   # Application logic
www/project/resources/             # Views and assets
www/project/database/migrations/   # Database migrations
```

## 🔄 Updates and Maintenance

### Updating WordPress

```bash
# From any directory
# Update WordPress core
docker exec -it php_{project-name} wp --allow-root core update

# Update plugins
docker exec -it php_{project-name} wp --allow-root plugin update --all

# Update themes
docker exec -it php_{project-name} wp --allow-root theme update --all
```

### Updating Laravel

```bash
# From any directory
# Update dependencies
docker exec -it laravel_{project-name} composer update

# Run migrations
docker exec -it laravel_{project-name} php artisan migrate

# Clear caches
docker exec -it laravel_{project-name} php artisan cache:clear
```

### Updating Docker Images

```bash
# From wp-local/docker/ directory
# Pull latest images
docker-compose pull

# Rebuild containers
docker-compose up --build -d
```

---

## 📋 Versioning & Releases

This project follows [Semantic Versioning](https://semver.org/) and uses automated releases via [semantic-release](https://github.com/semantic-release/semantic-release).

### Version Format

- **Major** (X.0.0): Breaking changes
- **Minor** (0.X.0): New features, backwards compatible
- **Patch** (0.0.X): Bug fixes, backwards compatible

### Automated Releases

Releases are automatically created when changes are pushed to the `main` branch. The version number is determined by analyzing commit messages following the [Conventional Commits](https://www.conventionalcommits.org/) specification.

### Commit Message Format

```bash
# Features (minor version bump)
feat(docker): add Redis service for caching

# Bug fixes (patch version bump)
fix: resolve MySQL connection timeout

# Breaking changes (major version bump)
feat(docker)!: upgrade to PHP 8.4
```

For more details, see [CONTRIBUTING.md](CONTRIBUTING.md).

---

## 🤝 Contributing

We welcome contributions! Please follow our commit message conventions to ensure proper versioning:

1. Use conventional commits format: `type(scope): description`
2. Run `npm run commit` for an interactive commit experience
3. Create feature branches and submit pull requests
4. Automated tests and releases run on merge to main

See [CONTRIBUTING.md](CONTRIBUTING.md) for detailed guidelines.

---

🚀 **Happy Development!**

*This environment supports both WordPress and Laravel development with automatic project detection, intelligent environment configuration, and streamlined workflows for modern PHP development.*
